<!DOCTYPE html>
<html>

	<head>
		<title>Orbit - Retrieve the OAuth token</title>
	</head>

	<body>

		<form style='display: none' method='POST' action='https://maikdevries.com/orbit/authenticate'>
			<input id='accessToken' type='hidden' name='accessToken' value=''>
			<input id='tokenType' type='hidden' name='tokenType' value=''>
		</form>

		<script>
			window.onload = async () => {
				const fragment = window.location.hash.substring(1).split('&').map((v) => v.split('=')).reduce((pre, [key, value]) => ({ ...pre, [key]: value }), {});

				if (localStorage.getItem('stateParameter') !== atob(decodeURIComponent(fragment.state))) return window.location.replace('https://maikdevries.com/orbit/csrf');

				localStorage.setItem('accessToken', fragment.access_token);
				localStorage.setItem('tokenType', fragment.token_type);

				document.getElementById('accessToken').value = fragment.access_token;
				document.getElementById('tokenType').value = fragment.token_type;

				document.forms[0].submit();
			}
		</script>
	</body>

</html>

<!DOCTYPE html>
<html>

	<head>
		<title>Orbit - Manage Lunar for your Discord server</title>

		<link rel='icon' href='./orbit/resources/favicon.png'>
		<script src='./orbit/js/authentication.js' defer></script>
		<script src='./orbit/js/getData.js' defer></script>
	</head>

	<body>

		<a id='authDiscord' style='display: none' href='https://discord.com/api/oauth2/authorize?client_id=827556501631139891&redirect_uri=https%3A%2F%2Fmaikdevries.com%2Forbit%2Fauthenticated.html&response_type=token&scope=identify%20guilds'>Authenticate</a>

		<p id='welcome' style='display: none'></p>

		<button id='logout' style='display: none' onclick='logout()'>Logout</button>

		<select id='guilds' style='display: none'></select>
		<button id='loadSettings' style='display: none'>Load settings</button>

		<pre id='guildSettings' style='display: none'></pre>

		<script>
			window.onload = async () => {
				if (!isAuthenticated()) {
					generateState();
					document.getElementById('authDiscord').style.display = 'block';
				} else {
					document.getElementById('welcome').innerText = `Welcome to Orbit, ${(await getDiscordUser()).username}! Please select the Discord server below.`;
					(await getDiscordGuilds()).forEach((guild) => {
						const guildSelector = document.createElement('option');
						guildSelector.innerText = guild.name;
						guildSelector.value = guild.id;
						document.getElementById('guilds').add(guildSelector);
					});

					document.getElementById('loadSettings').addEventListener('click', async () => {
						const settings = await getGuildSettings(document.getElementById('guilds').value);
						document.getElementById('guildSettings').innerText = JSON.stringify(settings, null, 2);
						document.getElementById('guildSettings').style.display = 'block';
					});

					document.getElementById('welcome').style.display = 'block';
					document.getElementById('guilds').style.display = 'block';
					document.getElementById('loadSettings').style.display = 'block';
					document.getElementById('logout').style.display = 'block';
				}
			}
		</script>

	</body>

</html>
